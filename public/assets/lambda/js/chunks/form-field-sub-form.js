"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[931],{20681:(t,e,a)=>{a.r(e),a.d(e,{default:()=>s});const o={props:["model","rule","label","meta"]};const s=(0,a(51900).Z)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("FormItem",{attrs:{label:t.label,prop:t.rule}},[a("div",[t._v("Not found")])])}),[],!1,null,null,null).exports},97250:(t,e,a)=>{a.r(e),a.d(e,{default:()=>i});var o=a(81293);const s={props:["form","model","editMode","relations","formula"],components:{"grid-form":a(50003).Z,dataform:()=>a.e(826).then(a.bind(a,37225))},mounted(){this.equationRenderer(),this.form.schema.forEach((t=>{t.disabled=!0}))},computed:{subStyle(){return this.form.min_height?{minHeight:this.form.min_height+"px",background:"#f3f4f5"}:void 0}},watch:{listData:{handler:function(t,e){this.hasEq&&this.equationData.map((e=>{if(e.hasEquation){e.data=-1;let a=0;switch(e.equation){case"SUM":e.data=0,t.map((t=>{e.data+=Number(isNaN(parseInt(t.model[e.model],10))?0:t.model[e.model])}));break;case"COUNT":e.data=0,t.map((t=>{e.data+=Number(1)}));break;case"MIN":t.map((t=>{-1==e.data?e.data=t.model[e.model]:e.data=Math.min(e.data,t.model[e.model])}));break;case"MAX":e.data=0,t.map((t=>{e.data=Math.max(e.data,t.model[e.model])}));break;case"AVG":e.data=0,t.map((t=>{a++,e.data+=Number(t.model[e.model])})),e.data=Number(e.data/a)}}}))},deep:!0}},data:()=>({listData:[],equationData:[],currentSortDir:"asc",hasEq:!1,modal_show:!1,editIndex:-1}),methods:{showAddModal(){this.modal_show=!0,this.$modal.show(`form-modal-${this.form.formId}`)},closeModal(){this.modal_show=!1,this.editIndex=-1,this.$modal.hide(`form-modal-${this.form.formId}`)},formReady(t,e){let a=e.findIndex((t=>t.model==this.form.parent));a>0&&(e[a].hidden=!0),this.editIndex>=0&&this.$refs.form.editModel(this.listData[this.editIndex].model[this.form.identity],{...this.listData[this.editIndex].model})},onError(){},onSuccess(t){if(console.log(t),this.editIndex>=0)Object.keys(t).forEach((e=>{this.listData[this.editIndex].form.identity!=e&&"created_at"!=e&&"updated_at"!=e&&Vue.set(this.listData[this.editIndex].model,e,t[e])}));else{let e=_.cloneDeep(this.form),a={};Object.keys(t).forEach((o=>{let s=e.schema.findIndex((t=>"key"==t.model));if(s>=0){if(e.identity==e.schema[s].model||null==e.schema[s].formType)return;if(e.timestamp&&("created_at"==e.schema[s].model||"updated_at"==e.schema[s].model))return}Vue.set(a,o,t[o])}));let o={form:e,model:a};null==this.model.form[this.model.component]&&(this.model.form[this.model.component]=[]),this.model.form[this.model.component].push(a),this.listData.push(o)}this.closeModal()},element:o.b,checkAddable(){return new Promise(((t,e)=>{let a=this.listData[this.listData.length-1];if(a){let o=!1,s=a.model;for(let t in s)null!=typeof s[t]&&null!=s[t]&&""!=s[t]&&0!=s[t]&&(o=!0);o?t(!0):(alert("Эхний мөрийг гүйцэд бөглөнө үү"),e(!1))}else t(!0)}))},addSubForm(){let t=_.cloneDeep(this.form),e={};t.schema.forEach((a=>{t.identity!=a.model&&null!=a.formType&&(!t.timestamp||"created_at"!=a.model&&"updated_at"!=a.model)&&Vue.set(e,a.model,a.default)}));let a={form:t,model:e};null==this.model.form[this.model.component]&&(this.model.form[this.model.component]=[]),this.model.form[this.model.component].push(e),this.listData.push(a)},add(){this.editIndex=-1,this.showAddModal()},fillData(){this.listData=[],setTimeout((()=>{this.model.form[this.model.component].forEach((t=>{let e={form:_.cloneDeep(this.form),model:t};this.listData.push(e)}))}),100)},equationRenderer(){this.equationData=[],this.form.schema.map((t=>{""==t.label||t.hidden||(t.hasEquation&&(this.hasEq=!0),this.equationData.push({hasEquation:t.hasEquation,equation:t.equations,prefix:t.prefix,model:t.model,preStaticWord:t.preStaticWord,data:0}))}))},edit(t){this.model.form[this.form.model][t],this.editIndex=t,this.showAddModal()},remove(t){this.model.form[this.form.model].splice(t,1),this.listData.splice(t,1)},reset(){this.model.form[this.form.model]=[],this.listData=[]},sort(t){let e=1;this.currentSortDir="asc"===this.currentSortDir?"desc":"asc",this.currentSort="desc"===this.currentSortDir?-1:1,this.currentSort=t.model,this.listData.sort(((t,a)=>("desc"===this.currentSortDir&&(e=-1),t.model[this.currentSort]<a.model[this.currentSort]?-1*e:t.model[this.currentSort]>a.model[this.currentSort]?1*e:0)))}}};const i=(0,a(51900).Z)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"subform-grid sub-modal-form",style:t.subStyle},[t.form.min_height||t.form.disableCreate?t._e():a("div",{staticClass:"subform-header"},[t._v("\n        "+t._s(t.form.name)+"\n        "),a("Button",{staticClass:"sub-form-add-btn",attrs:{shape:"circle",type:"success",size:"small",icon:"md-add"},on:{click:t.add}})],1),t._v(" "),t.form.min_height||this.listData.length>=1?a("table",{staticClass:"sub-form-grid",attrs:{border:"1"}},[a("thead",[a("tr",[t.form.showRowNumber?a("th",{staticClass:"row-number"},[t._v("ДД")]):t._e(),t._v(" "),t._l(t.form.schema,(function(e){return""==e.label||e.hidden?t._e():a("th",{key:e.index,on:{click:function(a){return t.sort(e)}}},[t._v("\n                "+t._s(e.label)+" "),a("i",{staticClass:"ti-exchange-vertical"})])})),t._v(" "),a("th",{staticClass:"action"},[t._v("...")])],2)]),t._v(" "),a("tbody",t._l(t.listData,(function(e,o){return a("grid-form",{key:o,attrs:{f:e.form,model:e.model,editMode:t.editMode,relations:t.relations,formula:t.formula}},[a("template",{slot:"action"},[a("a",{staticClass:"sub-edit",attrs:{href:"javscript:void(0)"},on:{click:function(){return t.edit(o)}}},[a("Icon",{attrs:{type:"md-create"}})],1),t._v(" "),t.form.disableDelete?t._e():a("a",{attrs:{href:"javscript:void(0)"},on:{click:function(){return t.remove(o)}}},[a("Icon",{attrs:{type:"ios-trash"}})],1)]),t._v(" "),t.form.showRowNumber?a("template",{slot:"rowNumber"},[a("span",[t._v(t._s(o+1))])]):t._e()],2)})),1),t._v(" "),t.hasEq?a("tfoot",[a("tr",[t._l(t.equationData,(function(e,o){return a("td",{key:o},[null!=e.preStaticWord&&""!=e.preStaticWord?a("span",[t._v(" "+t._s(e.preStaticWord)+" ")]):t._e(),t._v(" "),e.hasEquation?a("span",[t._v(t._s(e.data.toLocaleString()))]):t._e(),t._v(" "),null!=e.prefix&&""!=e.prefix?a("span",[t._v(" "+t._s(e.prefix))]):t._e()])})),t._v(" "),a("td")],2)]):t._e()]):t._e(),t._v(" "),t.form.min_height?a("a",{staticClass:"sub-grid-add",attrs:{href:"javascript:void(0)"},on:{click:t.add}},[a("Icon",{attrs:{type:"plus"}}),t._v("\n        "+t._s(""+(t.$static_words?t.$static_words.add:"Нэмэх"))+"\n    ")],1):t._e(),t._v(" "),a("paper-modal",{staticClass:"form-modal",attrs:{name:"form-modal-"+t.form.formId,"min-width":200,"min-height":100,"pivot-y":.5,adaptive:!0,reset:!0,draggable:!0,resizable:!0,draggable:".form-tool",width:"800",height:"70%"}},[a("section",{staticClass:"form-modal"},[a("div",{staticClass:"form-tool"},[a("h4",[t._v(t._s(t.form.name))]),t._v(" "),a("div",{staticClass:"form-tool-actions"},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:t.closeModal}},[a("i",{staticClass:"ti-close"})])])]),t._v(" "),a("div",{staticClass:"form-body"},[t.modal_show?a("dataform",{ref:"form",attrs:{schemaID:t.form.formId,do_render:t.modal_show,editMode:t.editIndex>=0,isSubForm:!0,onSuccess:t.onSuccess,onReady:t.formReady,onError:t.onError}}):t._e()],1)])])],1)}),[],!1,null,null,null).exports},50003:(t,e,a)=>{a.d(e,{Z:()=>d});var o=a(81293),s=(a(35341),a(54066));const i={props:["f","model","editMode","relations","formula"],created(){this.f.data={},this.f.schema.forEach((t=>{this.f.identity!=t.model&&null!=t.formType&&(!this.f.timestamp||"created_at"!=t.model&&"updated_at"!=t.model)&&(this.editMode?this.setModel(t.model,this.model[t.model],t.formType):this.setModel(t.model,t.default,t.formType),this.$watch("model."+t.model,{handler:(e,a)=>{this.afterChange(t.model,e,a)},deep:!0}))}))},methods:{element:o.b,setModel(t,e,a){switch(a){case"Switch":let a=!1;"true"!=e&&1!=e||(a=!0),this.model[t]=o,this.f.data[t]=o;break;case"Checkbox":let o=0;"true"!=e&&1!=e||(o=1),this.model[t]=o,this.f.data[t]=o;break;default:this.f.data[t]=e}},setMeta:t=>(delete t.table,delete t.rules,delete t.label,delete t.span,delete t.default,t),getSchemaIndex(t){return this.f.schema.findIndex((e=>e.model==t))},afterChange(t,e,a){(0,s.BS)(t,e,this.model,this.f.schema,this.$refs,this.$Notice),(0,s.x4)(this.formula,t,this.model,this.f.schema,this.f.rule,this.f.model)}}};const d=(0,a(51900).Z)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",[t.f.showRowNumber?a("td",{staticClass:"row-number"},[t._t("rowNumber")],2):t._e(),t._v(" "),t._l(t.f.schema,(function(e){return void 0!==e.formType&&null!==e.formType&&e.model&&!e.hidden&&e.model!=t.f.identity&&e.model!=t.f.parent&&"updated_at"!=e.model&&"created_at"!=e.model?a("td",{key:e.index},[t.model?a(t.element(e.formType),{tag:"component",attrs:{model:{form:t.model,component:e.model},size:"small",label:e.label?e.label:"["+e.model+"]",meta:t.setMeta(e),relation_data:""==e.relation.filter||void 0===e.relation.filter?t.relations[e.relation.table]?t.relations[e.relation.table].data:[]:t.relations[e.model]?t.relations[e.model].data:[]}}):t._e()],1):t._e()})),t._v(" "),a("td",{staticClass:"action"},[t._t("action")],2)],2)}),[],!1,null,null,null).exports}}]);